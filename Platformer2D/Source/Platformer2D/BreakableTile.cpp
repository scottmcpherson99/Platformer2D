// Fill out your copyright notice in the Description page of Project Settings.


#include "BreakableTile.h"

#include "PlayerCharacter.h"

#include "Components/BoxComponent.h"

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Sets default values
ABreakableTile::ABreakableTile()
{
	//create the trigger box component and attach it to the root
	TriggerBox = CreateDefaultSubobject<UBoxComponent>(TEXT("BoxComp"));
	TriggerBox->SetupAttachment(RootComponent);
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// BreakableTile Interface
void ABreakableTile::BeginPlay()
{
	Super::BeginPlay();

	//turn on collision checks for the collision box
	TriggerBox->OnComponentBeginOverlap.AddDynamic(this, &ABreakableTile::OnTriggerBoxOverlap);
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Collision
void ABreakableTile::OnTriggerBoxOverlap(UPrimitiveComponent* OverlappedComponent, AActor* OtherActor, UPrimitiveComponent* OtherComp, int32 OtherBodyIndex, bool bFromSweep, const FHitResult& SweepResult)
{
	//check to see if the overlapping actor is a player character, if it is, destroy the tile
	APlayerCharacter* playerCharacter = Cast<APlayerCharacter>(OtherActor);

	if (playerCharacter != nullptr)
	{
		tileStrength--;

		if (tileStrength < 1)
		{
			//destroy the tile
			GetWorldTimerManager().SetTimer(destroyTimer, this, &ABreakableTile::DestroyTile, 0.1f, false);
		}
	}
}
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


///////////////////////////////////////////////////////////////////////////////////////////////////////////
// Tile Destruction
// destroy the tile
void ABreakableTile::DestroyTile()
{
	Destroy();
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////